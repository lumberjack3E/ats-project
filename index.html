<!DOCTYPE html>
<html lang="en">

<head>

    <style>
/* ===================== Base Page Styles ===================== */
        body {
            font-family: 'Lato', sans-serif;
            max-width: 800px;
            margin: auto;
            padding: 2rem;
            background-color: #f9f9f9;
            color: #333;
        }

/* ===================== Main Content Wrapper ===================== */
        .main-content {
            margin-left: 220px;
            padding: 2rem;
            max-width: 800px;
        }

/* ===================== Header & Tagline ===================== */
        h1 {
            text-align: center;
            color: #225669; /*NWVIT Mountian Blue*/
        }

        p.tagline {
            text-align: center;
            color: #666;
            margin-top: -0.5rem;
            font-size: 1rem;
        }

/* ===================== Logo Styling ===================== */
        #logo-wrapper {
            text-align: center;
            margin-bottom: 0.5rem;
        }

        #nwvit-logo {
            max-width: 120px; /*reduced from 180*/
            height: auto;
            margin-top: 1rem;
            transition: transform 0.2s ease-in-out;
        }

        #nwvit-logo:hover {
            transform: scale(1.15);
        }
            
/* ===================== Form Elements ===================== */        
        label {
            font-weight: bold;
            display: block;
            margin-top: 1rem;
            text-align: left;
        }

        textarea {
            width: 100%;
            height: 150px;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.5rem;
            font-family: 'Lato', sans-serif;
            font-size: 1rem;
            font-style: italic;
            color: #333;
            box-sizing: border-box;
            display: block;
        }

/* ===================== Buttons ===================== */
        button {
            padding: 10px 20px;
            margin-right: 1rem;
            font-size: 1rem;
            cursor: pointer;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
        }

        button:hover {
            background-color: #34495e;
        }

/* ===================== Resume Drop Zone ===================== */        
        #resumeDropZone {
            width: 100%;
            box-sizing: border-box;
            padding: 0;
            margin: 0 0 1rem 0;
            background-color: transparent;
            border: none;
        }

/* ===================== Results Box ===================== */        
        #results {
            width: 100%;
            box-sizing: border-box;
            margin-top: 2rem;
            background: #ffffff;
            padding: 1rem;
            border: 1px solid #225669;
            border-radius: 6px;
        }

/* ===================== Sidebar Navigation ===================== */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 220px;
            background-color: #000;
            color: #ccc;
            padding-top: 2rem;
            font-family: 'Lato', sans-serif;
            box-shadow: 2px 0 6px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        .menu-header {
            color: #888;
            font-size: 0.8rem;
            font-weight: 700;
            padding: 0 1.5rem;
            margin-bottom: 1rem;
        }

        .menu-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .menu-list li {
            margin-bottom:  0.5rem;
        }

        .menu-list a {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #ccc;
            text-decoration: none;
            padding: 0.6rem 1.5rem;
            transition: background 0.2s ease;
            border-radius: 4px;
        }

        .menu-list a:hover {
            background-color: #1f1f1f;
            color: #fff;
        }

        .icon {
            font-size: 1.2rem;
        }

/* ===================== User Panel ===================== */
        .user-panel {
            position: absolute;
            top: 1rem;
            right: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background-color: #fff;
            padding: 0.4rem 0.75rem;
            border-radius: 30px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            font-family: 'Lato', sans-serif;
            font-size: 0.95rem;
            z-index: 1001;
        }

        .user-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-name {
            font-weight: 600;
            color: #333;
        }
    </style>

    <meta charset="UTF-8">
    <title>NWVIT Resume Analyzer</title>
    <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
    
    

</head>

<body>

<!-- ===================== Sidebar Navigation ===================== -->
 <div class="sidebar">
    <div class="menu-headder">MENU</div>
    <ul class="menu-list">
        <li><a href="#"><span class="icon">üë§</span> Profile</a></li>
        <li><a href="#"><span class="icon">üíº</span> Jobs</a></li>
        <li><a href="#"><span class="icon">‚öôÔ∏è</span> Settings</a></li>
    </ul>
 </div>

<!-- ===================== Logo & Tagline ===================== -->
<div id="logo-wrapper">
    <a href="https://www.nwvit.org/" target="_blank">
        <img src="Logo.png" alt="NWVIT Logo" id="nwvit-logo">
    </a>
</div>

<h1>Resume Compatibility Tool</h1>
<p class="tagline">Built by Veterans, for Veterans</p>


<!-- ===================== Job Title Search Box ===================== -->
<div id="jobSearchBox" style="text-align: center; margin-bottom: 1rem;">
    <input type="text" id="jobTitleSearch" placeholder="Enter a job title (e.g. SOC Analyst)" style="padding: 0.5rem; width: 60%; font-size: 1rem;">
    <button onclick="populateJD()">Suggest Keywords</button>
</div>

<!-- ===================== Top User Panel ===================== -->
<div class="user-panel">
    <img src="user-placeholder.png" alt="User Icon" class="user-icon">
    <span class="user-name">Admin</span>
</div>

<!-- ===================== Resume Input Area ===================== -->
 <div id="resumeDropZone">
    <p><strong>Drag & Drop Or Upload Your Resume</strong></p>
    <input type="file" id="resumeFile" accept=".txt, .docx, .pdf"><br><br>
    <textarea id="resume" placeholder="Upload, Drop, or Paste Resume Here..." autofocus></textarea>
 </div>

<!-- ===================== Job Title Search Input ===================== -->
<div style="margin-bottom: 1rem;">
    <label for="jobSearch" style="font-weight: bold;">Search for Job Title</label>
    <input type="text" id="jobSearch" placeholder="e.g. SOC Analyst" style="width: 100%; padding: 0.5rem; font-size: 1rem;">
    <button onclick="fetchJDTemplate()" style="margin-top: 0.5rem;">Suggest Keywords</button>
</div>

<!-- ===================== Job Description Box ===================== -->
<label for="jd" style="display: block; text-align: left; font-weight: bold; margin-top: 1rem;">Paste the Job Description</label><br>
<textarea id="jd" placeholder="Paste job description here..."></textarea>

<!-- ===================== Action Buttons ===================== -->
<button onclick="analyze()">Analyze</button>
<button onclick="resetFields()">Reset</button>

<!-- ===================== Output Area ===================== -->
<div id="results"></div>

<script>

// ===================== Resume Analyzer Function =====================
async function analyze() {
    const resumeText = document.getElementById('resume').value;
    const jobText = document.getElementById('jd').value;

    const response = await fetch('http://127.0.0.1:8000/analyze', {
        method: 'POST',
        headers: {'Content-Type': 'application/json' }, 
        body: JSON.stringify({
            resume_text: resumeText,
            job_description: jobText
        })
    });

    const data = await response.json();

    document.getElementById('results').innerHTML = `
        <h2>Results</h2>
        <p><strong>Score:</strong> ${data.score}%</p>
        <p><strong>Feedback:</strong> ${data.feedback}</p>
        <p><strong>Missing Keywords:</strong> ${data.missing_keywords.join(', ')}</p>
    `;
}

// ===================== Reset Tool State =====================
function resetFields() {
    document.getElementById('resume').value = "";
    document.getElementById('jd').value = "";
    document.getElementById('results').innerHTML = "";
    document.getElementById('resumeFile').value = "";
    //document.getElementById('jdFile').value = ""; // Commented out: Not Being Used
document.getElementById('resume').focus();
}

// ===================== Drag & Drop Functionality =====================
const resumeDropZone = document.getElementById('resumeDropZone');

resumeDropZone.addEventListener('dragover', function (e) {
    e.preventDefault();
    resumeDropZone.style.backgroundColor = ''; //Provides Visual Feedback: Not Being Used
});

resumeDropZone.addEventListener('dragleave', function () {
    resumeDropZone.style.backgroundColor = '';
});

resumeDropZone.addEventListener('drop', function (e) {
    e.preventDefault();
    resumeDropZone.style.backgroundColor = '';

    const file = e.dataTransfer.files[0];
    if (!file) return;

    document.getElementById('resumeFile').files = e.dataTransfer.files;
        
    const changeEvent = new Event('change');
    document.getElementById('resumeFile').dispatchEvent(changeEvent);
});

// ===================== File Upload Handler =====================
document.getElementById('resumeFile').addEventListener('change', function (){
    const file = this.files[0];
    if (!file) return;

       const ext = file.name.split('.').pop().toLowerCase();

       if (ext == "txt") {
        const reader = new FileReader();
        reader.onload = function (e) {
            const text = e.target.result;
            document.getElementById('resume').value = text;
        
        };
        reader.readAsText(file);
    } else if (ext === "docx") {
        file.arrayBuffer().then(function (buffer) {
            mammoth.extractRawText({arrayBuffer: buffer})
                .then(function (result) {
                    document.getElementById('resume').value = result.value;
                })
                .catch(function (err) {
                    alert("Error reading .docx file: " + err.message);
                });
        });
    } else if (ext === "pdf") {
        const reader = new FileReader();
        reader.onload = function (e) {
            const typedarray = new Uint8Array(e.target.result);

            pdfjsLib.getDocument({ data: typedarray }).promise.then(function (pdf) {
                let textPromises = [];

                for (let i = 1; i <= pdf.numPages; i++) {
                    textPromises.push(
                        pdf.getPage(i).then(function (page) {
                            return page.getTextContent().then(function (content) {
                                return content.items.map(item => item.str).join(" ");
                            });
                        })
                    );
                }

                Promise.all(textPromises).then(function (pagesText) {
                    const fullText = pagesText.join("\n\n");
                    document.getElementById('resume').value = fullText;
                });
            });
        };
        reader.readAsArrayBuffer(file);
        
    } else {
        alert("Unsupported file type. Please upload a .txt or .docx file.");
    }
});

/*
// ===================== Job Description Upload Support =====================
// (Currently Disabled for Simplicity. Uncomment is Re-Enabled in Future)


document.getElementById('jdFile').addEventListener('change', function () {
    const file = this.files[0];
    if (!file) return;

    const ext = file.name.split('.').pop().toLowerCase();

    if (ext === "txt") {
        const reader = new FileReader();
        reader.onload = function (e) {
            const text = e.target.result;
            document.getElementById('jd').value = text;
        };
        reader.readAsText(file);
    } else if (ext === "docx") {
        file.arrayBuffer().then(function (buffer){
            mammoth.extractRawText({ arrayBuffer: buffer })
                .then(function (result) {
                    document.getElementById('jd').value = result.value;
                })
                .catch(function (err){
                    alert("Error reading file: " + err.message);
                })
        });
    } else if (ext === "pdf") {
        const reader = new FileReader();
        reader.onload = function (e) {
            const typedarray = new Uint8Array(e.target.result);
            pdfjsLib.getDocument({ data: typedarray }).promise.then(function (pdf) {
                let textPromises = [];

                for(let i = 1; i <= pdf.numPages; i++) {
                    textPromises.push(
                        pdf.getPage(i).then(function (page) {
                            return page.getTextContent().then(function (content) {
                                return content.items.map(item => item.str).join(" ");
                            });
                        })
                    );
                }

                Promise.all(textPromises).then(function (pagesText){
                    const fullText = pagesText.join("\n\n");
                    document.getElementById('jd').value = fullText;
                });
            });
        };
        reader.readAsArrayBuffer(file);
    } else {
        alert("Unsupported file type. Please upload a .txt, .docx, or .pdf file.");
    }
});

// ===================== End of Job Description Upload Support =====================
*/

// ===================== Fetch JD Keywords from Search =====================
function fetchJDTemplate() {
    const jobTitle = document.getElementById('jobSearch').value.trim().toLowerCase();

    const templates = {
        "soc analyst": `Monitor SIEM dashboards for alerts\nInvestigate incidents and triage security events\nWork with Splunk, CrowdStrike, or SentinelOne\nEscalate critical findings to senior analysts\nAnalyze logs and system activity\nKnowledge of MITRE ATT&CK framework`,
        "security engineer": `Design and implement secure network infrastructure\nPerform risk assessments and threat modeling\nCollaborate with DevOps teams on secure CI/CD\nDeploy and maintain firewalls, IDS/IPS\nPerform system hardening and vulnerability scanning\nWork with tools like Nessus, Nmap, Wireshark`,
        "penetration tester": `Conduct internal and external penetration tests\nExploit known vulnerabilities and misconfigurations\nCreate comprehensive risk reports with mitigation steps\nUse tools such as Metasploit, Burp Suite, and Kali Linux\nSimulate phishing or red team engagements\nExperience with web app, network, and wireless testing`
        // More job roles to come later!
    };

    const suggestion = templates[jobTitle];

    if (suggestion) {
        document.getElementById('jd').value = suggestion;
    } else {
        alert("No template found for that title");
    }
}
</script>
</body>
</html>